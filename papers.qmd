---
title: ""
comments: false
sidebar: false
---


::: {.legend-box}
**Legend:**
<span class="legend-item" data-topic="topic-processing"><span class="legend-color topic-processing"></span>Processing</span>
<span class="legend-item" data-topic="topic-semantics"><span class="legend-color topic-semantics"></span>Semantics</span>
<span class="legend-item" data-topic="topic-morphology"><span class="legend-color topic-morphology"></span>Morphology</span>
<span class="legend-item" data-topic="topic-phonology"><span class="legend-color topic-phonology"></span>Phonology</span>
<span class="legend-item" data-topic="topic-syntax"><span class="legend-color topic-syntax"></span>Syntax</span>
<span class="legend-item" data-topic="topic-resource"><span class="legend-color topic-resource"></span>Resources</span>
:::

<script src="/files/filter-v1.js"></script>

```{r}
#| echo: false
#| results: asis

library(yaml)

# read
papers <- yaml::read_yaml("_data/writing.yaml")

# small helpers
nz <- function(x) !is.null(x) && x != ""

# formatters per type
fmt_common_links <- function(x) {
  links <- c()
  if (nz(x$pdf))      links <- c(links, sprintf('[<a href="%s" target="_blank" title="Paper">pdf</a>]', x$pdf))
  if (nz(x$preprint)) links <- c(links, sprintf('[<a href="%s" target="_blank" title="Preprint">preprint</a>]', x$preprint))
  if (nz(x$url))      links <- c(links, sprintf('[<a href="%s" target="_blank" title="Link">link</a>]', x$url))
  if (nz(x$doi))      links <- c(links, sprintf('[<a href="https://doi.org/%s" target="_blank" title="DOI">doi</a>]', x$doi))
  if (nz(x$repo))     links <- c(links, sprintf('[<a href="%s" target="_blank" title="Code">code</a>]', x$repo))
  # Handle non-standard keys by checking if they exist
  if (nz(x$lingbuzz)) links <- c(links, sprintf('[<a href="%s" target="_blank" title="LingBuzz">lingbuzz</a>]', x$lingbuzz))
  if (nz(x$psyarxiv)) links <- c(links, sprintf('[<a href="%s" target="_blank" title="PsyArXiv">psyarxiv</a>]', x$psyarxiv))
  
  if (length(links)) paste('<span class="paper-links">', paste(links, collapse=" "), '</span>') else ""
}

fmt_dissertation <- function(x){
  line <- sprintf('%s (%s). <em>%s</em>. %s.',
                  x$authors, x$year, x$title, x$type)
  if (nz(x$institution)) line <- paste(line, x$institution)
  paste0(line, if (nz(x$institution)) "." else "", " ", fmt_common_links(x))
}

fmt_article <- function(x){
  nz_chr <- function(v) ifelse(is.null(v) || identical(v, ""), "", as.character(v))

  authors <- nz_chr(x$authors)
  year    <- nz_chr(x$year)
  title   <- nz_chr(x$title)
  journal <- nz_chr(x$journal)
  volume  <- nz_chr(x$volume)
  issue   <- nz_chr(x$issue)
  pages   <- nz_chr(x$pages)
  status  <- nz_chr(x$status)

  # volume/issue block like "39(4)" or "39" or ""
  voliss <- if (volume != "" && issue != "") {
    sprintf("%s(%s)", volume, issue)
  } else if (volume != "") {
    volume
  } else ""

  # base citation line:
  if (journal != "") {
    line <- sprintf(
      '%s (%s). <em>%s</em>. <strong>%s</strong>%s%s.',
      authors, year, title, journal,
      if (voliss != "") paste0(", ", voliss) else "",
      if (pages  != "") paste0(", ", pages)  else ""
    )
    if (status != "") line <- paste0(line, " (", status, ").")
  } else {
    line <- sprintf('%s (%s). <em>%s</em>.', authors, year, title)
    if (status != "") line <- paste0(line, " (", status, ").")
  }

  paste0(line, " ", fmt_common_links(x))
}


fmt_chapter <- function(x){
  in_title <- if (nz(x[["in"]])) sprintf("In %s", x[["in"]]) else ""

  editors  <- x[["editors"]]
  ed_tag   <- if (nz(editors)) {
    if (grepl("[,;]\\band\\b", editors)) "eds." else "ed."
  } else ""
  eds      <- if (nz(editors)) sprintf(" (%s %s)", ed_tag, editors) else ""

  have_container <- nz(in_title) || nz(eds)
  pub <- if (nz(x[["publisher"]])) {
    paste0(if (have_container) ", " else "", x[["publisher"]])
  } else ""

  status <- if (nz(x[["status"]])) paste0(" (", x[["status"]], ")") else ""

  line <- sprintf(
    '%s (%s). <em>%s</em>. %s%s%s.',
    x[["authors"]], x[["year"]], x[["title"]], in_title, eds, pub
  )

  paste0(line, status, " ", fmt_common_links(x))
}

fmt_inprogress <- function(x){
  status <- if (nz(x$status)) paste0(" (", x$status, ")") else ""
  note   <- if (nz(x$note)) paste0(" <em>(", x$note, ")</em>") else ""
  line <- sprintf('%s (%s). <em>%s</em>.', x$authors, x$year, x$title)
  paste0(line, status, note, " ", fmt_common_links(x))
}

fmt_proceedings <- function(x){
  vol <- if (nz(x$volume)) paste0(", ", x$volume) else ""
  iss <- if (nz(x$issue)) paste0("(", x$issue, ")") else ""
  art <- if (nz(x$article)) paste0(": ", x$article) else ""
  pages <- if (nz(x$pages)) paste0(", ", x$pages) else ""
  line <- sprintf('%s (%s). <em>%s</em>. <strong>%s</strong>%s%s%s.',
                  x$authors, x$year, x$title, x$proceedings, vol, iss, art)
  paste0(line, pages, " ", if (nz(x$doi)) sprintf('<span style="font-variant: small-caps;">Doi:</span> %s. ', x$doi) else "", fmt_common_links(x))
}

# helper to coerce possibly NULL to ""
nz_chr <- function(x) ifelse(is.null(x), "", x)

render_section <- function(items, formatter, heading){
  if (is.null(items) || !length(items)) return(invisible())
  cat(sprintf("\n\n## %s\n\n", heading))
  out <- vapply(seq_along(items), function(i){
    item <- items[[i]]
    html <- formatter(item)
    topic_cls <- if (nz(item$topic)) paste0("topic-", item$topic) else ""
    sprintf('<div class="ref-item %s"><span class="ref-num">[%d]</span><span class="ref-text">%s</span></div>', topic_cls, i, html)
  }, character(1))
  cat(paste(out, collapse = "\n"))
}

render_section(papers$dissertation,    fmt_dissertation, "Dissertation / Thesis")
render_section(papers$journal_articles,fmt_article,      "Journal Articles")
render_section(papers$book_chapters,   fmt_chapter,      "Book Chapters")
render_section(papers$in_progress,     fmt_inprogress,   "In Progress")
render_section(papers$proceedings,     fmt_proceedings,  "Proceedings")

```